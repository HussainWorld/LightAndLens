@model IEnumerable<LightAndLensCL.Models.ReturnRecord>
@{
    ViewData["Title"] = "Return Records";
}

<h2>Return Records</h2>

<form method="get" class="row g-3 mb-4" id="filterForm">
    <div class="col-md-3">
        <label>Condition</label>
        <select id="condition" name="condition" class="form-select">
            <option value="">All</option>
            <option value="Excellent">Excellent</option>
            <option value="Slight Wear">Slight Wear</option>
            <option value="Requires Maintenance">Requires Maintenance</option>
        </select>
    </div>

    <div class="col-md-3">
        <label>Return Date From</label>
        <input id="startDate" type="date" name="startDate" class="form-control" />
    </div>

    <div class="col-md-3">
        <label>Return Date To</label>
        <input id="endDate" type="date" name="endDate" class="form-control" />
    </div>

    <div class="col-md-3 d-flex align-items-end">
        <input id="searchBox" type="text" class="form-control" placeholder="Search by customer..." />
    </div>
</form>

<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Return ID</th>
            <th>Equipment</th>
            <th>Returned By</th>
            <th>Return Date</th>
            <th>Condition</th>
            <th>Notes</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="returns-table-body">
        @await Html.PartialAsync("_ReturnPartial", Model)
    </tbody>
</table>

@section Scripts {
    <script>
        const conditionFilter = document.getElementById('condition');
        const startDate = document.getElementById('startDate');
        const endDate = document.getElementById('endDate');
        const searchBox = document.getElementById('searchBox');

        function fetchFilteredReturns() {
            const condition = conditionFilter.value;
            const start = startDate.value;
            const end = endDate.value;
            const search = searchBox.value;

            const url = `/ReturnRecords/Search?condition=${encodeURIComponent(condition)}&startDate=${start}&endDate=${end}&search=${encodeURIComponent(search)}`;

            fetch(url)
                .then(response => response.text())
                .then(html => {
                    document.getElementById('returns-table-body').innerHTML = html;
                })
                .catch(error => console.error('Error during live filter:', error));
        }

        conditionFilter.addEventListener('change', fetchFilteredReturns);
        startDate.addEventListener('change', fetchFilteredReturns);
        endDate.addEventListener('change', fetchFilteredReturns);
        searchBox.addEventListener('keyup', fetchFilteredReturns);
    </script>
}





